{"version":3,"file":"closure-compiler-rollup.js","sources":["../src/log.js","../src/index.js"],"sourcesContent":["/*\r\nBased on code here: https://github.com/camelaissani/rollup-plugin-closure-compiler-js/blob/master/src/index.js\r\n*/\r\nvar colors = {\r\n  red: process.env.NODE_DISABLE_COLORS ? '' : '\\x1b[31m',\r\n  yellow: process.env.NODE_DISABLE_COLORS ? '' : '\\x1b[33m',\r\n  normal: process.env.NODE_DISABLE_COLORS ? '' : '\\x1b[0m'\r\n}\r\n\r\nfunction loopMsgs (arr, color) {\r\n  function logMsg (msg) {\r\n    console.log(colors[color] + msg + colors.normal)\r\n  }\r\n  arr.forEach(function (msg) {\r\n    if (!msg.file && (msg.lineNo < 0 || !msg.lineNo)) {\r\n      logMsg(msg.type)\r\n    } else {\r\n      logMsg(msg.file + ':' + msg.lineNo + ' (' + msg.type + ')')\r\n    }\r\n    logMsg('    ' + msg.description)\r\n  })\r\n}\r\n\r\nexport default function (output) {\r\n  if (output.warnings && Array.isArray(output.warnings)) {\r\n    loopMsgs(output.warnings, 'yellow')\r\n  }\r\n  if (output.errors && Array.isArray(output.errors)) {\r\n    console.log(JSON.stringify(output.errors))\r\n\r\n    loopMsgs(output.errors, 'red')\r\n    return output.errors.length > 0\r\n  } else {\r\n    return false\r\n  }\r\n}\r\n","import logger from './log'\r\nconst ClosureCompiler = require('google-closure-compiler').jsCompiler\r\n\r\nexport default function closureIt (flags) {\r\n  return {\r\n    name: 'closure-compile',\r\n    renderChunk: async function (code, ChunkInfo) {\r\n      // console.log(code)\r\n      // console.log(JSON.stringify(ChunkInfo))\r\n      var newFlags = {\r\n        processCommonJsModules: true,\r\n        path: ChunkInfo.name,\r\n        sourceMap: ChunkInfo.map, // The original sourcemap\r\n        fileName: ChunkInfo.name,\r\n        level: 'SIMPLE'\r\n      }\r\n      if (flags && flags === Object(flags)) {\r\n        for (var prop in flags) {\r\n          if (flags.hasOwnProperty(prop)) {\r\n            newFlags[prop] = flags[prop]\r\n          }\r\n        }\r\n      }\r\n\r\n      newFlags.src = code\r\n\r\n      var newCompiler = new ClosureCompiler({\r\n        compilation_level:\r\n          newFlags.level ||\r\n          newFlags.compilation_level ||\r\n          newFlags.compilationLevel\r\n      })\r\n\r\n      var compilerProcess = newCompiler.run([newFlags], function (\r\n        exitCode,\r\n        stdOut,\r\n        stdErr\r\n      ) {})\r\n      if (logger(compilerProcess)) {\r\n        throw new Error(\r\n          'Compilation error - ' +\r\n            compilerProcess.errors.length +\r\n            ' error' +\r\n            (compilerProcess.errors.length === 1 ? '' : 's')\r\n        )\r\n      }\r\n      return {\r\n        code: compilerProcess.compiledCode,\r\n        map: compilerProcess.sourceMap\r\n      }\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}