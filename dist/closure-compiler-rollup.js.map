{"version":3,"file":"closure-compiler-rollup.js","sources":["../src/log.js","../src/index.js"],"sourcesContent":["/*\r\nBased on code here: https://github.com/camelaissani/rollup-plugin-closure-compiler-js/blob/master/src/index.js\r\n*/\r\nvar colors = {\r\n  red: process.env.NODE_DISABLE_COLORS ? '' : '\\x1b[31m',\r\n  yellow: process.env.NODE_DISABLE_COLORS ? '' : '\\x1b[33m',\r\n  normal: process.env.NODE_DISABLE_COLORS ? '' : '\\x1b[0m'\r\n}\r\n\r\nfunction loopMsgs (arr, color) {\r\n  function logMsg (msg) {\r\n    console.log(colors[color] + msg + colors.normal)\r\n  }\r\n  arr.forEach(function (msg) {\r\n    if (!msg.file && (msg.lineNo < 0 || !msg.lineNo)) {\r\n      logMsg(msg.type)\r\n    } else {\r\n      logMsg(msg.file + ':' + msg.lineNo + ' (' + msg.type + ')')\r\n    }\r\n    logMsg('    ' + msg.description)\r\n  })\r\n}\r\n\r\nexport default function (output) {\r\n  if (\r\n    output.warnings &&\r\n    Array.isArray(output.warnings) &&\r\n    output.warnings.length > 0\r\n  ) {\r\n    loopMsgs(output.warnings, 'yellow')\r\n  }\r\n  if (\r\n    output.errors &&\r\n    Array.isArray(output.errors) &&\r\n    output.errors.length > 0\r\n  ) {\r\n    // console.log(JSON.stringify(output.errors))\r\n\r\n    loopMsgs(output.errors, 'red')\r\n    return true\r\n  } else {\r\n    return false\r\n  }\r\n}\r\n","import logger from './log'\r\nconst ClosureCompiler = require('google-closure-compiler').jsCompiler\r\n\r\nexport default function closureIt (flags) {\r\n  return {\r\n    name: 'closure-compile',\r\n    renderChunk: async function (code, ChunkInfo) {\r\n      // console.log(code)\r\n      // console.log(JSON.stringify(ChunkInfo))\r\n      var newFlags = {\r\n        processCommonJsModules: true,\r\n        path: ChunkInfo.name,\r\n        sourceMap: ChunkInfo.map, // The original sourcemap\r\n        fileName: ChunkInfo.name,\r\n        level: 'SIMPLE'\r\n      }\r\n      if (flags && flags === Object(flags)) {\r\n        for (var prop in flags) {\r\n          if (flags.hasOwnProperty(prop)) {\r\n            newFlags[prop] = flags[prop]\r\n          }\r\n        }\r\n      }\r\n\r\n      newFlags.src = code\r\n\r\n      var newCompiler = new ClosureCompiler({\r\n        compilation_level:\r\n          newFlags.compilationLevel ||\r\n          newFlags.compilation_level ||\r\n          newFlags.level\r\n      })\r\n\r\n      var compilerProcess = newCompiler.run([newFlags], function (\r\n        exitCode,\r\n        stdOut,\r\n        stdErr\r\n      ) {})\r\n      if (logger(compilerProcess)) {\r\n        throw new Error(\r\n          'Compilation error - ' +\r\n            compilerProcess.errors.length +\r\n            ' error' +\r\n            (compilerProcess.errors.length === 1 ? '' : 's')\r\n        )\r\n      }\r\n      return {\r\n        code: compilerProcess.compiledCode,\r\n        map: compilerProcess.sourceMap\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Eventually I might add a babel plugin-builder utility as shown on the rollup-plugin-babel page\r\n"],"names":["colors","red","process","env","NODE_DISABLE_COLORS","yellow","normal","loopMsgs","arr","color","logMsg","msg","console","log","forEach","file","lineNo","type","description","output","warnings","Array","isArray","length","errors","ClosureCompiler","require","jsCompiler","closureIt","flags","name","renderChunk","code","ChunkInfo","newFlags","processCommonJsModules","path","sourceMap","map","fileName","level","Object","prop","hasOwnProperty","src","newCompiler","compilation_level","compilationLevel","compilerProcess","run","exitCode","stdOut","stdErr","logger","Error","compiledCode"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;;;EAGA,IAAIA,MAAM,GAAG;EACXC,EAAAA,GAAG,EAAEC,OAAO,CAACC,GAAR,CAAYC,mBAAZ,GAAkC,EAAlC,GAAuC,UADjC;EAEXC,EAAAA,MAAM,EAAEH,OAAO,CAACC,GAAR,CAAYC,mBAAZ,GAAkC,EAAlC,GAAuC,UAFpC;EAGXE,EAAAA,MAAM,EAAEJ,OAAO,CAACC,GAAR,CAAYC,mBAAZ,GAAkC,EAAlC,GAAuC;EAHpC,CAAb;;EAMA,SAASG,QAAT,CAAmBC,GAAnB,EAAwBC,KAAxB,EAA+B;EAC7B,WAASC,MAAT,CAAiBC,GAAjB,EAAsB;EACpBC,IAAAA,OAAO,CAACC,GAAR,CAAYb,MAAM,CAACS,KAAD,CAAN,GAAgBE,GAAhB,GAAsBX,MAAM,CAACM,MAAzC;EACD;;EACDE,EAAAA,GAAG,CAACM,OAAJ,CAAY,UAAUH,GAAV,EAAe;EACzB,QAAI,CAACA,GAAG,CAACI,IAAL,KAAcJ,GAAG,CAACK,MAAJ,GAAa,CAAb,IAAkB,CAACL,GAAG,CAACK,MAArC,CAAJ,EAAkD;EAChDN,MAAAA,MAAM,CAACC,GAAG,CAACM,IAAL,CAAN;EACD,KAFD,MAEO;EACLP,MAAAA,MAAM,CAACC,GAAG,CAACI,IAAJ,GAAW,GAAX,GAAiBJ,GAAG,CAACK,MAArB,GAA8B,IAA9B,GAAqCL,GAAG,CAACM,IAAzC,GAAgD,GAAjD,CAAN;EACD;;EACDP,IAAAA,MAAM,CAAC,SAASC,GAAG,CAACO,WAAd,CAAN;EACD,GAPD;EAQD;;AAED,EAAe,iBAAUC,MAAV,EAAkB;EAC/B,MACEA,MAAM,CAACC,QAAP,IACAC,KAAK,CAACC,OAAN,CAAcH,MAAM,CAACC,QAArB,CADA,IAEAD,MAAM,CAACC,QAAP,CAAgBG,MAAhB,GAAyB,CAH3B,EAIE;EACAhB,IAAAA,QAAQ,CAACY,MAAM,CAACC,QAAR,EAAkB,QAAlB,CAAR;EACD;;EACD,MACED,MAAM,CAACK,MAAP,IACAH,KAAK,CAACC,OAAN,CAAcH,MAAM,CAACK,MAArB,CADA,IAEAL,MAAM,CAACK,MAAP,CAAcD,MAAd,GAAuB,CAHzB,EAIE;EACA;EAEAhB,IAAAA,QAAQ,CAACY,MAAM,CAACK,MAAR,EAAgB,KAAhB,CAAR;EACA,WAAO,IAAP;EACD,GATD,MASO;EACL,WAAO,KAAP;EACD;EACF;;EC1CD,IAAMC,eAAe,GAAGC,OAAO,CAAC,yBAAD,CAAP,CAAmCC,UAA3D;;AAEA,EAAe,SAASC,SAAT,CAAoBC,KAApB,EAA2B;EACxC,SAAO;EACLC,IAAAA,IAAI,EAAE,iBADD;EAELC,IAAAA,WAAW;EAAA;EAAA;EAAA,8BAAE,iBAAgBC,IAAhB,EAAsBC,SAAtB;EAAA;EAAA;EAAA;EAAA;EAAA;EACX;EACA;EACIC,gBAAAA,QAHO,GAGI;EACbC,kBAAAA,sBAAsB,EAAE,IADX;EAEbC,kBAAAA,IAAI,EAAEH,SAAS,CAACH,IAFH;EAGbO,kBAAAA,SAAS,EAAEJ,SAAS,CAACK,GAHR;EAGa;EAC1BC,kBAAAA,QAAQ,EAAEN,SAAS,CAACH,IAJP;EAKbU,kBAAAA,KAAK,EAAE;EALM,iBAHJ;;EAUX,oBAAIX,KAAK,IAAIA,KAAK,KAAKY,MAAM,CAACZ,KAAD,CAA7B,EAAsC;EACpC,uBAASa,IAAT,IAAiBb,KAAjB,EAAwB;EACtB,wBAAIA,KAAK,CAACc,cAAN,CAAqBD,IAArB,CAAJ,EAAgC;EAC9BR,sBAAAA,QAAQ,CAACQ,IAAD,CAAR,GAAiBb,KAAK,CAACa,IAAD,CAAtB;EACD;EACF;EACF;;EAEDR,gBAAAA,QAAQ,CAACU,GAAT,GAAeZ,IAAf;EAEIa,gBAAAA,WApBO,GAoBO,IAAIpB,eAAJ,CAAoB;EACpCqB,kBAAAA,iBAAiB,EACfZ,QAAQ,CAACa,gBAAT,IACAb,QAAQ,CAACY,iBADT,IAEAZ,QAAQ,CAACM;EAJyB,iBAApB,CApBP;EA2BPQ,gBAAAA,eA3BO,GA2BWH,WAAW,CAACI,GAAZ,CAAgB,CAACf,QAAD,CAAhB,EAA4B,UAChDgB,QADgD,EAEhDC,MAFgD,EAGhDC,MAHgD,EAIhD,EAJoB,CA3BX;;EAAA,qBAgCPC,MAAM,CAACL,eAAD,CAhCC;EAAA;EAAA;EAAA;;EAAA,sBAiCH,IAAIM,KAAJ,CACJ,yBACEN,eAAe,CAACxB,MAAhB,CAAuBD,MADzB,GAEE,QAFF,IAGGyB,eAAe,CAACxB,MAAhB,CAAuBD,MAAvB,KAAkC,CAAlC,GAAsC,EAAtC,GAA2C,GAH9C,CADI,CAjCG;;EAAA;EAAA,iDAwCJ;EACLS,kBAAAA,IAAI,EAAEgB,eAAe,CAACO,YADjB;EAELjB,kBAAAA,GAAG,EAAEU,eAAe,CAACX;EAFhB,iBAxCI;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA,OAAF;;EAAA;EAAA;EAAA;;EAAA;EAAA;EAFN,GAAP;EAgDD;;;;;;;;"}