{"version":3,"file":"closure-compiler-rollup.js","sources":["../src/log.js","../src/index.js"],"sourcesContent":["/*\r\nBased on code here: https://github.com/camelaissani/rollup-plugin-closure-compiler-js/blob/master/src/index.js\r\n*/\r\nvar chalk = require('chalk')\r\n\r\nfunction loopMsgs(arr, color) {\r\n  function logMsg(msg) {\r\n    console.log(chalk[color](msg))\r\n  }\r\n  arr.forEach(function(msg) {\r\n    if (!msg.file && (msg.lineNo < 0 || !msg.lineNo)) {\r\n      logMsg(msg.type)\r\n    } else {\r\n      logMsg(msg.file + ':' + msg.lineNo + ' (' + msg.type + ')')\r\n    }\r\n    logMsg(msg.description)\r\n  })\r\n}\r\n\r\nexport default function(output) {\r\n  loopMsgs(output.warnings, 'orange')\r\n  loopMsgs(output.errors, 'red')\r\n\r\n  return output.errors.length > 0\r\n}\r\n\r\n// loopMsgs(\r\n//   [\r\n//     { type: 'ReferenceError', description: 'SomeError' },\r\n//     {\r\n//       type: 'ReferenceError',\r\n//       description: 'SomeError',\r\n//       lineNo: 30,\r\n//       file: 'index.js'\r\n//     }\r\n//   ],\r\n//   'red'\r\n// )\r\n","import logger from './log'\r\nconst ClosureCompiler = require('google-closure-compiler').jsCompiler\r\n\r\nexport default function closure(flags) {\r\n  return {\r\n    name: 'closure-compiler-new',\r\n    renderChunk(code, ChunkInfo) {\r\n      var output\r\n      var fileName = ChunkInfo.fileName\r\n      var originalSourceMap = ChunkInfo.map\r\n      if (!flags) {\r\n        flags = {}\r\n      }\r\n      flags = Object.assign(\r\n        {\r\n          createSourceMap: true,\r\n          processCommonJsModules: true,\r\n          sourceMap: originalSourceMap,\r\n          path: fileName // This may break stuff, not sure\r\n        },\r\n        flags\r\n      )\r\n      flags.src = code\r\n\r\n      var newCompiler = new ClosureCompiler({\r\n        compilation_level: flags.level\r\n      })\r\n\r\n      var compilerProcess = closureCompiler.run(\r\n        [flags],\r\n        (exitCode, stdOut, stdErr) => {\r\n          console.log(stdOut.compiledCode)\r\n          output = stdOut\r\n          //compilation complete\r\n        }\r\n      )\r\n\r\n      if (logger(output)) {\r\n        throw new Error(\r\n          `compilation error, ${output.errors.length} error${\r\n            output.errors.length === 0 || output.errors.length > 1 ? 's' : ''\r\n          }`\r\n        )\r\n      }\r\n      return { code: output.compiledCode, map: output.sourceMap }\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}